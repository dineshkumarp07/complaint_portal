<div class="complaints-container">
  <!-- Background Animation -->
  <div class="background-animation">
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
      <div class="shape shape-4"></div>
    </div>
  </div>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <div class="hero-icon">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
        </svg>
      </div>
      <h1 class="hero-title" *ngIf="!isAdmin">My Complaint Dashboard</h1>
      <h1 class="hero-title" *ngIf="isAdmin">Admin Complaint Management</h1>
      <p class="hero-description" *ngIf="!isAdmin">
        Track and monitor the status of all your submitted complaints in real-time
      </p>
      <p class="hero-description" *ngIf="isAdmin">
        View and manage all student complaints submitted through the complaint registration system
      </p>
    </div>
  </div>

  <!-- Admin Welcome Message -->
  <div class="admin-welcome" *ngIf="isAdmin && !isLoading">
    <div class="admin-welcome-card">
      <div class="admin-welcome-header">
        <svg viewBox="0 0 24 24" fill="currentColor" class="admin-icon">
          <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
        </svg>
        <h2>Welcome, Administrator!</h2>
      </div>
      <p>You are currently viewing all student complaints. Use the table below to monitor complaint statuses.</p>
      <div class="admin-stats" *ngIf="complaints.length > 0">
        <div class="stat-item">
          <span class="stat-number">{{ complaints.length }}</span>
          <span class="stat-label">Total Complaints</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ getPendingCount() }}</span>
          <span class="stat-label">Pending</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ getResolvedCount() }}</span>
          <span class="stat-label">Resolved</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Section - Only show for non-admin users -->
  <div class="search-section" *ngIf="!isAdmin">
    <div class="search-card">
      <div class="search-header">
        <h2>Search Your Complaints</h2>
        <p *ngIf="!isLoggedIn && !showSearchForm">Enter your Student ID to access your complaint history</p>
        <p *ngIf="isLoggedIn && !isLoading && !showSearchForm">Welcome back! Your complaints are being loaded automatically for Student ID: <strong>{{ studentID }}</strong></p>
        <p *ngIf="isLoggedIn && isLoading">Loading your complaints for Student ID: <strong>{{ studentID }}</strong>...</p>
        <p *ngIf="showSearchForm">Enter a Student ID to search for complaints</p>
      </div>
      
      <div class="search-form" *ngIf="showSearchForm">
        <div class="input-group">
          <div class="input-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
          
          <input 
            [(ngModel)]="studentID" 
            type="text" 
            placeholder="Enter your Student ID or Anonymous Tracking Code" 
            class="search-input"
            (keyup.enter)="fetchComplaints()"
            [disabled]="isLoading"
          />
        </div>
        
        <div class="button-group">
          <button 
            (click)="fetchComplaints()" 
            class="search-btn"
            [disabled]="!studentID.trim() || isLoading"
          >
            <span *ngIf="!isLoading">Search Complaints</span>
            <span *ngIf="isLoading">Searching...</span>
            <svg *ngIf="!isLoading" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
            <div *ngIf="isLoading" class="loading-spinner-small"></div>
          </button>
          
          <button 
            (click)="showAnonymousTrackingCodes()" 
            class="tracking-codes-btn stylish-tracking-btn"
            [disabled]="isLoading"
          >
            <span>View Tracking Codes</span>
            <svg viewBox="0 0 24 24" fill="currentColor" class="tracking-icon">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </button>
        </div>
      </div>
      

      <!-- Success Message for Auto-loaded Complaints -->
      <div class="success-message" *ngIf="isLoggedIn && complaints.length > 0 && !isLoading && !showSearchForm">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        Successfully loaded {{ complaints.length }} complaint{{ complaints.length !== 1 ? 's' : '' }} for Student ID: {{ studentID }}
      </div>

      <!-- Error Message -->
      <div class="error-message" *ngIf="errorMessage">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        {{ errorMessage }}
      </div>
    </div>
  </div>

  <!-- Action Buttons Section -->
  <div class="action-buttons-section" *ngIf="hasSearched && !isLoading">
    <div class="action-buttons">
      <!-- Admin Logout Button -->
      <button 
        (click)="clearAdminSession()" 
        class="action-btn admin-logout-btn"
        *ngIf="isAdmin"
      >
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
        </svg>
        Admin Logout
      </button>

      <!-- Student-specific buttons -->
      <button 
        (click)="searchForDifferentStudent()" 
        class="action-btn search-different-btn"
        *ngIf="!showSearchForm && !isAdmin"
      >
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        Search Different Student ID
      </button>
      
      <button 
        (click)="clearSearch()" 
        class="action-btn clear-btn"
        *ngIf="isLoggedIn && !isAdmin"
      >
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
        Clear Session
      </button>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section" *ngIf="complaints.length > 0">
    <div class="results-header">
      <h2 *ngIf="!isAdmin">Your Complaint History</h2>
      <h2 *ngIf="isAdmin">All Student Complaints</h2>
      <div class="results-summary">
        <span class="total-complaints">{{ complaints.length }} complaint{{ complaints.length !== 1 ? 's' : '' }} found</span>
        <span class="student-id" *ngIf="!isAdmin">Student ID: {{ studentID }}</span>
        <span class="student-id" *ngIf="isAdmin">Admin View - All Students</span>
      </div>
    </div>
    
    <div class="complaints-table-container">
      <table class="complaints-table">
        <thead>
          <tr>
            <th>Complaint ID</th>
            <th *ngIf="isAdmin">Student ID</th>
            <th>Title</th>
            <th>Category</th>
            <th>Description</th>
            <th>Priority</th>
            <th>Submitted Date</th>
            
            
            <th>Process</th>

      
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let complaint of complaints; let i = index" class="complaint-row">
            <td class="complaint-id">#{{ complaint._id?.slice(-6) || (i + 1) }}</td>
            <td *ngIf="isAdmin" class="student-id-cell">{{ complaint.studentID || 'Anonymous' }}</td>
            <td class="complaint-title">
              <span [title]="complaint.isHighRisk ? 'High-risk detected' : (complaint.requiresAttention ? 'Requires attention' : '')">
                {{ complaint.title || 'No Title' }}
              </span>
              <span *ngIf="complaint.isHighRisk" class="risk-badge" title="High-risk complaint">
                ‚ö†Ô∏è High Risk
              </span>
              <span *ngIf="!complaint.isHighRisk && complaint.requiresAttention" class="attention-badge" title="Requires attention">
                ‚ùó Attention
              </span>
            </td>
            <td class="complaint-category">{{ complaint.category || 'General' }}</td>
            <td class="complaint-description">
              <ng-container *ngIf="isAdmin; else studentDesc">
                <button class="view-status-btn" (click)="showFullStatus(complaint)">View</button>
              </ng-container>
              <ng-template #studentDesc>
                {{ complaint.complaint || 'No description' }}
              </ng-template>
            </td>
            <td class="complaint-priority">
              <span class="priority-badge" [ngClass]="getPriorityClass(complaint.priority)">
                {{ complaint.priority || 'Medium' }}
              </span>
            </td>
            <td class="complaint-status">
              <span class="status-badge" [ngClass]="getStatusClass(complaint.status)">
                {{ complaint.status || 'Pending' }}
              </span>
            </td>
            <td class="complaint-date">
              {{ formatDate(complaint.submissionDate || complaint.createdAt) }}
            </td>
            
            <!-- Admin Actions -->
            <td *ngIf="isAdmin" class="admin-actions">
              <div class="action-buttons">
                <button 
                  *ngIf="complaint.status === 'Pending'"
                  (click)="resolveComplaint(complaint)" 
                  class="action-btn resolve-btn"
                  title="Mark as Resolved"
                >
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                  </svg>
                  Resolve
                </button>
                <button 
                  *ngIf="complaint.status === 'Pending'"
                  (click)="markInProgress(complaint)" 
                  class="action-btn progress-btn"
                  title="Mark as In Progress"
                >
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                  In Progress
                </button>
                <button 
                  (click)="deleteComplaint(complaint)" 
                  class="action-btn delete-btn"
                  title="Delete Complaint"
                >
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                  </svg>
                  Delete
                </button>
              </div>
              <!-- Status Message -->
              <div class="status-message" *ngIf="complaint.status === 'Resolved'">
                <span class="resolved-icon">‚úÖ</span> Problem Solved
              </div>
              <div class="status-message" *ngIf="complaint.status === 'In Progress'">
                <span class="progress-icon">üîÑ</span> In Process
              </div>
              <div class="status-message" *ngIf="complaint.status === 'Pending'">
                <span class="pending-icon">‚è≥</span> Awaiting Action
              </div>
            </td>
            <!-- Student Details Button -->
            <td *ngIf="!isAdmin" class="complaint-details">
              <button class="view-details-btn" (click)="viewComplaintDetails(complaint)">
                View Details
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="complaints.length === 0 && hasSearched && !isLoading">
    <div class="empty-icon">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
      </svg>
    </div>
    <h3 *ngIf="!isAdmin">No Complaints Found</h3>
    <h3 *ngIf="isAdmin">No Complaints Available</h3>
    <p *ngIf="!isAdmin">No complaints were found for Student ID: <strong>{{ studentID }}</strong></p>
    <p *ngIf="isAdmin">There are currently no complaints in the system.</p>
    <p class="empty-suggestion" *ngIf="!isAdmin">
      If you haven't submitted any complaints yet, you can 
      <a routerLink="/register" class="link-primary">submit your first complaint here</a>.
    </p>
    <div class="empty-actions">
      <button (click)="searchForDifferentStudent()" class="action-btn" *ngIf="!isAdmin">
        Search Different Student ID
      </button>
      <button (click)="loadAllComplaints()" class="action-btn" *ngIf="isAdmin">
        Refresh Complaints
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
    </div>
    <p *ngIf="!isAdmin">Searching for your complaints...</p>
    <p *ngIf="isAdmin">Loading all complaints...</p>
  </div>
</div>
