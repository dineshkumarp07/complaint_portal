<!-- Forum Header -->
<div class="forum-header">
  <div class="header-content">
    <div class="header-title">
      <h1>Student Discussion Forum</h1>
      <p>Share your concerns and help fellow students anonymously</p>
    </div>
    <button class="create-post-btn" (click)="openCreatePostModal()">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
      New Post
    </button>
  </div>
</div>

<!-- Forum Stats -->
<div class="forum-stats">
  <div class="stat-card">
    <div class="stat-icon">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/>
      </svg>
    </div>
    <div class="stat-info">
      <span class="stat-number">{{ stats.totalPosts }}</span>
      <span class="stat-label">Total Posts</span>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4v3c0 .6.4 1 1 1h.5c.2 0 .5-.1.7-.3L16.5 18H20c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
      </svg>
    </div>
    <div class="stat-info">
      <span class="stat-number">{{ stats.totalReplies }}</span>
      <span class="stat-label">Replies</span>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-4h3v4h2v-7.5c0-.83.67-1.5 1.5-1.5S12 9.67 12 10.5V18h2v-7.5c0-1.93-1.57-3.5-3.5-3.5S7 8.57 7 10.5V16H4v2z"/>
      </svg>
    </div>
    <div class="stat-info">
      <span class="stat-number">{{ stats.activeUsers }}</span>
      <span class="stat-label">Active Users</span>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
      </svg>
    </div>
    <div class="stat-info">
      <span class="stat-number">{{ stats.resolvedIssues }}</span>
      <span class="stat-label">Resolved</span>
    </div>
  </div>
</div>

<!-- Forum Controls -->
<div class="forum-controls">
  <div class="search-section">
    <div class="search-input">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
      </svg>
      <input type="text" 
             [(ngModel)]="searchQuery" 
             (keyup.enter)="searchPosts()"
             placeholder="Search posts...">
      <button (click)="searchPosts()" *ngIf="searchQuery">Search</button>
    </div>
  </div>

  <div class="filter-section">
    <select [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
      <option value="all">All Categories</option>
      <option *ngFor="let category of categories" [value]="category.id">
        {{ category.name }}
      </option>
    </select>

    <select [(ngModel)]="sortBy" (change)="onSortChange()">
      <option value="recent">Most Recent</option>
      <option value="popular">Most Popular</option>
      <option value="replies">Most Replies</option>
      <option value="views">Most Viewed</option>
    </select>
  </div>
</div>

<!-- Posts List -->
<div class="posts-container">
  <div class="post-card" *ngFor="let post of posts" (click)="incrementViewCount(post.id)">
    <!-- Post Header -->
    <div class="post-header">
      <div class="post-category" [style.background-color]="getCategoryColor(post.category)">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        {{ post.category }}
      </div>
      <div class="post-status">
        <span class="resolved-badge" *ngIf="post.isResolved">âœ“ Resolved</span>
        <span class="pinned-badge" *ngIf="post.isPinned">ðŸ“Œ Pinned</span>
      </div>
    </div>

    <!-- Post Content -->
    <div class="post-content">
      <h3 class="post-title">{{ post.title }}</h3>
      <p class="post-excerpt">{{ post.content.substring(0, 200) }}{{ post.content.length > 200 ? '...' : '' }}</p>
      
      <div class="post-tags" *ngIf="post.tags.length > 0">
        <span class="tag" *ngFor="let tag of post.tags">#{{ tag }}</span>
      </div>
    </div>

    <!-- Post Footer -->
    <div class="post-footer">
      <div class="post-author">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
        <span>{{ post.authorName }}</span>
        <span class="post-date">{{ formatDate(post.createdAt) }}</span>
      </div>

      <div class="post-actions">
        <div class="vote-section">
          <button class="vote-btn upvote" (click)="votePost(post.id, true); $event.stopPropagation()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
            </svg>
            <span>{{ post.upvotes }}</span>
          </button>
          <button class="vote-btn downvote" (click)="votePost(post.id, false); $event.stopPropagation()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
            </svg>
            <span>{{ post.downvotes }}</span>
          </button>
        </div>

        <div class="post-stats">
          <span class="stat">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4v3c0 .6.4 1 1 1h.5c.2 0 .5-.1.7-.3L16.5 18H20c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
            </svg>
            {{ post.replies.length }}
          </span>
          <span class="stat">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
            </svg>
            {{ post.viewCount }}
          </span>
        </div>

        <button class="resolve-btn" 
                *ngIf="!post.isResolved"
                (click)="markAsResolved(post.id); $event.stopPropagation()">
          Mark Resolved
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="posts.length === 0">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2z"/>
    </svg>
    <h3>No posts found</h3>
    <p>Be the first to start a discussion!</p>
    <button class="create-post-btn" (click)="openCreatePostModal()">Create Post</button>
  </div>
</div>

<!-- Create Post Modal -->
<div class="modal-overlay" *ngIf="isCreatePostModalOpen" (click)="closeCreatePostModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Post</h2>
      <button class="close-modal-btn" (click)="closeCreatePostModal()">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <form class="create-post-form" (ngSubmit)="createPost()">
      <div class="form-group">
        <label for="postTitle">Title *</label>
        <input type="text" 
               id="postTitle"
               [(ngModel)]="newPost.title" 
               name="title"
               placeholder="Enter a descriptive title..."
               required>
      </div>

      <div class="form-group">
        <label for="postCategory">Category *</label>
        <select id="postCategory" [(ngModel)]="newPost.category" name="category" required>
          <option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="postContent">Content *</label>
        <textarea id="postContent"
                  [(ngModel)]="newPost.content" 
                  name="content"
                  placeholder="Describe your issue or question in detail..."
                  rows="6"
                  required></textarea>
      </div>

      <div class="form-group">
        <label for="postTags">Tags (optional)</label>
        <input type="text" 
               id="postTags"
               [(ngModel)]="newPost.tags" 
               name="tags"
               placeholder="Enter tags separated by commas (e.g., urgent, wifi, library)">
      </div>

      <div class="form-group checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="newPost.isAnonymous" name="anonymous">
          <span class="checkmark"></span>
          Post anonymously
        </label>
      </div>

      <div class="form-group" *ngIf="!newPost.isAnonymous">
        <label for="authorName">Your Name</label>
        <input type="text" 
               id="authorName"
               [(ngModel)]="newPost.authorName" 
               name="authorName"
               placeholder="Enter your name">
      </div>

      <div class="modal-actions">
        <button type="button" class="cancel-btn" (click)="closeCreatePostModal()">Cancel</button>
        <button type="submit" class="submit-btn" [disabled]="!newPost.title.trim() || !newPost.content.trim()">
          Create Post
        </button>
      </div>
    </form>
  </div>
</div>
