<!-- Floating Chat Button -->
<div class="chat-fab" *ngIf="!isChatOpen" (click)="openChat()">
  <svg viewBox="0 0 24 24" fill="currentColor">
    <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4v3c0 .6.4 1 1 1h.5c.2 0 .5-.1.7-.3L16.5 18H20c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-3 12H7v-2h10v2zm0-3H7V9h10v2zm0-3H7V6h10v2z"/>
  </svg>
  <div class="chat-badge" *ngIf="!currentSession">
    <span>Need Help?</span>
  </div>
</div>

<!-- Chat Window -->
<div class="chat-window" *ngIf="isChatOpen" [class.minimized]="isChatMinimized">
  <!-- Chat Header -->
  <div class="chat-header">
    <div class="header-info">
      <div class="bot-avatar">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      </div>
      <div class="bot-info">
        <h4>Support Assistant</h4>
        <span class="status">Online</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="minimize-btn" (click)="minimizeChat()" *ngIf="!isChatMinimized">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 13H5v-2h14v2z"/>
        </svg>
      </button>
      <button class="maximize-btn" (click)="maximizeChat()" *ngIf="isChatMinimized">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 13H5v-2h14v2z"/>
        </svg>
      </button>
      <button class="close-btn" (click)="closeChat()">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Chat Body -->
  <div class="chat-body" *ngIf="!isChatMinimized">
    <!-- Messages Container -->
    <div class="messages-container" #messagesContainer>
      <div class="message" 
           *ngFor="let message of messages" 
           [class.user-message]="!message.isBot"
           [class.bot-message]="message.isBot">
        
        <div class="message-avatar" *ngIf="message.isBot">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        </div>

        <div class="message-content">
          <div class="message-bubble">
            <p>{{ message.content }}</p>
          </div>
          <div class="message-time">
            {{ formatTime(message.timestamp) }}
          </div>
        </div>

        <div class="message-avatar user-avatar" *ngIf="!message.isBot">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div class="message bot-message" *ngIf="isTyping">
        <div class="message-avatar">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        </div>
        <div class="message-content">
          <div class="typing-indicator">
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Replies -->
    <div class="quick-replies" *ngIf="getQuickRepliesFromLastBotMessage().length > 0">
      <button class="quick-reply-btn" 
              *ngFor="let reply of getQuickRepliesFromLastBotMessage()"
              (click)="sendQuickReply(reply)">
        {{ reply.text }}
      </button>
    </div>

    <!-- Input Area -->
    <div class="chat-input">
      <div class="input-container">
        <textarea 
          [(ngModel)]="userInput"
          (keypress)="onKeyPress($event)"
          placeholder="Type your message..."
          rows="1"
          class="message-input"
          [disabled]="isTyping">
        </textarea>
        <button class="send-btn" 
                (click)="sendMessage()" 
                [disabled]="!userInput.trim() || isTyping">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>
